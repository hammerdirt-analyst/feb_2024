
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Extracting land use values &#8212; Project 2025</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'extracting_topo_data';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Empirical Bayes" href="multinomial_conjugate.html" />
    <link rel="prev" title="The survey data" href="the_survey_data.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="titlepage.html">
  
  
  
  
  
  
    <p class="title logo__title">Project 2025</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="titlepage.html">
                    The litter assistant
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Data and reporting</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="final_report.html">Canton Bern Lakes</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_cases.html">Use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="report_results-rough-draft.html">Rough draft Survey report</a></li>
<li class="toctree-l1"><a class="reference internal" href="new_report.html">Forecast</a></li>


<li class="toctree-l1"><a class="reference internal" href="project.html">Proposal</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods and classes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="a_report_class.html">Survey report class</a></li>
<li class="toctree-l1"><a class="reference internal" href="landuse_class.html">Land use class</a></li>
<li class="toctree-l1"><a class="reference internal" href="forecasts.html">Grid forecast class</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine_learning.html">machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="haystackagents.html">Haystack agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="langchainagents.html">Langchain agents</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Annex</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="the_survey_data.html">The survey data</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Extracting land use values</a></li>
<li class="toctree-l1"><a class="reference internal" href="multinomial_conjugate.html">Empirical Bayes</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent_prompts_relations.html">Prompts and agent tools</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/extracting_topo_data.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Extracting land use values</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#technical-requirements">Technical requirements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-point-and-a-buffer">A point and a buffer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-location-attributes-land-cover">Retrieve location attributes: land-cover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#undefined-areas">Undefined areas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#public-services-land-use">Public services: land-use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-map-of-land-cover">Building a map of land cover</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-qgis">Using QGIS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-street-lengths">Extracting street lengths</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#land-cover">Land-cover</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#land-use">Land-use</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#streets">Streets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rivers-intersection-size-and-class">Rivers: intersection, size and class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#intersection-size-and-class">intersection, size and class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-to-intersection">distance to intersection</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_uses_l</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a_location</span> <span class="ow">in</span> <span class="n">lake_locations</span><span class="p">:</span>
    <span class="n">this_location</span> <span class="o">=</span> <span class="n">locations_and_coordinates</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">a_location</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">this_point</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="n">bufferbounds</span> <span class="o">=</span> <span class="n">a_point_buffer</span><span class="p">(</span><span class="n">this_location</span><span class="p">)</span>
    <span class="n">buffer_content_i</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="s1">&#39;data/ignorethis/shapes/landcover.shp&#39;</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
    
    <span class="c1"># identify the undefined areas</span>
    <span class="n">combined_polygon</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
    <span class="n">combined_Pn</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">combined_polygon</span><span class="p">]},</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="n">undefined</span> <span class="o">=</span> <span class="n">compute_undefined_sections_of_buffer</span><span class="p">(</span><span class="n">abuffer</span><span class="p">,</span><span class="n">combined_Pn</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
    
    <span class="c1"># combine the known land cover with the undefined</span>
    <span class="n">buffer_content_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">buffer_content_i</span><span class="p">,</span> <span class="n">undefined</span><span class="p">])</span>
    
    <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">objcolumn</span><span class="o">=</span><span class="s1">&#39;OBJEKTART&#39;</span><span class="p">,</span> <span class="n">objval</span><span class="o">=</span><span class="s1">&#39;land-cover&#39;</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
    <span class="n">nz</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="s1">&#39;data/ignorethis/shapes/nutuzungsareal.shp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="n">nz_comb</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">nz</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
    <span class="n">nz_comb</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">([{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">nz_comb</span><span class="p">,</span> <span class="s1">&#39;buffer-name&#39;</span><span class="p">:</span><span class="n">a_location</span><span class="p">,</span> <span class="s1">&#39;land-cover&#39;</span><span class="p">:</span> <span class="s1">&#39;public-services&#39;</span> <span class="p">}],</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    
    
    <span class="n">fz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span><span class="s1">&#39;data/ignorethis/shapes/freizeit.shp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="n">fz_comb</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">fz</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
    <span class="n">fz_comb</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">([{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">fz_comb</span><span class="p">,</span> <span class="s1">&#39;buffer-name&#39;</span><span class="p">:</span><span class="n">a_location</span><span class="p">,</span> <span class="s1">&#39;land-cover&#39;</span><span class="p">:</span> <span class="s1">&#39;recreation&#39;</span> <span class="p">}],</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">buffer_content_i</span><span class="p">,</span> <span class="n">nz_comb</span><span class="p">,</span> <span class="n">fz_comb</span><span class="p">])</span>
    
    
    <span class="c1"># indentify the contents of the buffer</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">bufferbounds</span>
    <span class="n">streets</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;data/ignorethis/shapes/strasse.shp&#39;</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">))</span>
    <span class="n">streets</span> <span class="o">=</span> <span class="n">streets</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">streets</span> <span class="o">=</span> <span class="n">streets</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
    <span class="n">streets</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">streets</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">,</span> <span class="n">keep_geom_type</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">t</span> <span class="o">=</span> <span class="n">compute_landuse_percent_of_buffer</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">abuffer</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;land-cover&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">t</span><span class="p">[</span><span class="s1">&#39;streets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">streets</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">length</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;See&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_location</span>
    <span class="n">land_uses_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">land_uses_l</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 128 entries, rate to rate
Data columns (total 13 columns):
 #   Column           Non-Null Count  Dtype  
---  ------           --------------  -----  
 0   Siedl            128 non-null    float64
 1   Sumpf            128 non-null    float64
 2   Wald             128 non-null    float64
 3   public-services  128 non-null    float64
 4   recreation       128 non-null    float64
 5   undefined        128 non-null    float64
 6   streets          128 non-null    float64
 7   location         128 non-null    object 
 8   Reben            128 non-null    float64
 9   Fels             128 non-null    float64
 10  Stadtzentr       128 non-null    float64
 11  Obstanlage       128 non-null    float64
 12  Geroell          128 non-null    float64
dtypes: float64(12), object(1)
memory usage: 14.0+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_uses_r</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a_location</span> <span class="ow">in</span> <span class="n">river_locations</span><span class="p">:</span>
    <span class="n">this_location</span> <span class="o">=</span> <span class="n">locations_and_coordinates</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">a_location</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">this_point</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="n">bufferbounds</span> <span class="o">=</span> <span class="n">a_point_buffer</span><span class="p">(</span><span class="n">this_location</span><span class="p">)</span>
    <span class="n">buffer_content_i</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="s1">&#39;data/ignorethis/shapes/landcover.shp&#39;</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
    
    <span class="c1"># identify the undefined areas</span>
    <span class="n">combined_polygon</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
    <span class="n">combined_Pn</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">combined_polygon</span><span class="p">]},</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="n">undefined</span> <span class="o">=</span> <span class="n">compute_undefined_sections_of_buffer</span><span class="p">(</span><span class="n">abuffer</span><span class="p">,</span><span class="n">combined_Pn</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
    
    <span class="c1"># combine the known land cover with the undefined</span>
    <span class="n">buffer_content_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">buffer_content_i</span><span class="p">,</span> <span class="n">undefined</span><span class="p">])</span>
    
    <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">objcolumn</span><span class="o">=</span><span class="s1">&#39;OBJEKTART&#39;</span><span class="p">,</span> <span class="n">objval</span><span class="o">=</span><span class="s1">&#39;land-cover&#39;</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
    <span class="n">nz</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="s1">&#39;data/ignorethis/shapes/nutuzungsareal.shp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="n">nz_comb</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">nz</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
    <span class="n">nz_comb</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">([{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">nz_comb</span><span class="p">,</span> <span class="s1">&#39;buffer-name&#39;</span><span class="p">:</span><span class="n">a_location</span><span class="p">,</span> <span class="s1">&#39;land-cover&#39;</span><span class="p">:</span> <span class="s1">&#39;public-services&#39;</span> <span class="p">}],</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    
    
    <span class="n">fz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span><span class="s1">&#39;data/ignorethis/shapes/freizeit.shp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="n">fz_comb</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">fz</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
    <span class="n">fz_comb</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">([{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">fz_comb</span><span class="p">,</span> <span class="s1">&#39;buffer-name&#39;</span><span class="p">:</span><span class="n">a_location</span><span class="p">,</span> <span class="s1">&#39;land-cover&#39;</span><span class="p">:</span> <span class="s1">&#39;recreation&#39;</span> <span class="p">}],</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">buffer_content_i</span><span class="p">,</span> <span class="n">nz_comb</span><span class="p">,</span> <span class="n">fz_comb</span><span class="p">])</span>
    
    
    <span class="c1"># indentify the contents of the buffer</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">bufferbounds</span>
    <span class="n">streets</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;data/ignorethis/shapes/strasse.shp&#39;</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">))</span>
    <span class="n">streets</span> <span class="o">=</span> <span class="n">streets</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">streets</span> <span class="o">=</span> <span class="n">streets</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
    <span class="n">streets</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">streets</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">,</span> <span class="n">keep_geom_type</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">compute_landuse_percent_of_buffer</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">abuffer</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;land-cover&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">t</span><span class="p">[</span><span class="s1">&#39;streets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">streets</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">length</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_location</span>
    <span class="n">land_uses_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">land_uses_r</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">rv</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rv</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;See&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newlu</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">f</span><span class="p">,</span><span class="n">rv</span><span class="p">])</span>
<span class="n">newlu</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rename</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Siedl&#39;</span><span class="p">:</span><span class="s1">&#39;buildings&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Sumpf&#39;</span><span class="p">:</span><span class="s1">&#39;wetlands&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Wald&#39;</span><span class="p">:</span> <span class="s1">&#39;forest&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Reben&#39;</span><span class="p">:</span> <span class="s1">&#39;vineyards&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Fels&#39;</span><span class="p">:</span> <span class="s1">&#39;cliffs&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Stadtzentr&#39;</span><span class="p">:</span> <span class="s1">&#39;city-center&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Obstanlage&#39;</span><span class="p">:</span><span class="s1">&#39;orchards&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Geroell&#39;</span> <span class="p">:</span> <span class="s1">&#39;boulders&#39;</span>
<span class="p">}</span>

<span class="n">newlu</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">newlu</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;buildings&#39;, &#39;wetlands&#39;, &#39;forest&#39;, &#39;public-services&#39;, &#39;recreation&#39;,
       &#39;undefined&#39;, &#39;streets&#39;, &#39;vineyards&#39;, &#39;cliffs&#39;, &#39;city-center&#39;,
       &#39;orchards&#39;, &#39;boulders&#39;],
      dtype=&#39;object&#39;, name=&#39;land-cover&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newlu</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/in_process/new_lu.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/in_process/new_lu.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>location</th>
      <th>buildings</th>
      <th>wetlands</th>
      <th>forest</th>
      <th>public-services</th>
      <th>recreation</th>
      <th>undefined</th>
      <th>streets</th>
      <th>vineyards</th>
      <th>cliffs</th>
      <th>city-center</th>
      <th>orchards</th>
      <th>boulders</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>aabach</td>
      <td>0.223</td>
      <td>0.108</td>
      <td>0.372</td>
      <td>0.008</td>
      <td>0.011</td>
      <td>0.298</td>
      <td>9096.446</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>anarchy-beach</td>
      <td>1.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.079</td>
      <td>0.020</td>
      <td>0.000</td>
      <td>5526.409</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>arabie</td>
      <td>0.914</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.132</td>
      <td>0.015</td>
      <td>0.016</td>
      <td>17114.587</td>
      <td>0.070</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ascona-traghetto-spiaggia</td>
      <td>0.701</td>
      <td>0.000</td>
      <td>0.178</td>
      <td>0.028</td>
      <td>0.075</td>
      <td>0.100</td>
      <td>12206.680</td>
      <td>0.000</td>
      <td>0.021</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>augustmutzenbergstrandweg</td>
      <td>0.682</td>
      <td>0.000</td>
      <td>0.153</td>
      <td>0.044</td>
      <td>0.005</td>
      <td>0.149</td>
      <td>8185.826</td>
      <td>0.015</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>220</th>
      <td>urnaesch_urnaesch_meierr</td>
      <td>0.074</td>
      <td>0.000</td>
      <td>0.199</td>
      <td>0.002</td>
      <td>0.000</td>
      <td>0.727</td>
      <td>13778.192</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>221</th>
      <td>via-brunari-spiaggia</td>
      <td>0.462</td>
      <td>0.000</td>
      <td>0.367</td>
      <td>0.043</td>
      <td>0.023</td>
      <td>0.162</td>
      <td>19550.078</td>
      <td>0.009</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>222</th>
      <td>via-mirasole-spiaggia</td>
      <td>0.516</td>
      <td>0.000</td>
      <td>0.330</td>
      <td>0.045</td>
      <td>0.024</td>
      <td>0.144</td>
      <td>20912.391</td>
      <td>0.011</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>223</th>
      <td>vorderrhein_disentis_schmidn</td>
      <td>0.169</td>
      <td>0.000</td>
      <td>0.458</td>
      <td>0.019</td>
      <td>0.009</td>
      <td>0.322</td>
      <td>16782.652</td>
      <td>0.000</td>
      <td>0.049</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.002</td>
    </tr>
    <tr>
      <th>224</th>
      <td>zulg_steffisburg_schmassmanne</td>
      <td>0.779</td>
      <td>0.000</td>
      <td>0.058</td>
      <td>0.031</td>
      <td>0.002</td>
      <td>0.163</td>
      <td>17152.428</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
<p>225 rows × 13 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># landuse and cover for a river or park location</span>
<span class="c1"># make a buffer for a location</span>
<span class="n">a_location</span> <span class="o">=</span> <span class="n">lake_locations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">this_location</span> <span class="o">=</span> <span class="n">locations_and_coordinates</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">a_location</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">this_point</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="n">bufferbounds</span> <span class="o">=</span> <span class="n">a_point_buffer</span><span class="p">(</span><span class="n">this_location</span><span class="p">)</span>

<span class="c1"># indentify the contents of the buffer    </span>
<span class="n">buffer_content_i</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="s1">&#39;data/ignorethis/shapes/landcover.shp&#39;</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beaches</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mannewil&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>latitude                46.996382
longitude                7.239024
country                        CH
feature_type                    l
display_feature_name         Aare
city_slug                kallnach
feature_name                 aare
city                     Kallnach
parent_boundary              aare
canton                       Bern
Name: mannewil, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buffer_content</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>buffer-name</th>
      <th>land-cover</th>
      <th>geometry</th>
      <th>color</th>
      <th>buffer-area-dry</th>
      <th>area_m2</th>
      <th>rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>anarchy-beach</td>
      <td>See</td>
      <td>POLYGON ((2554545.000 1145275.000, 2554865.000...</td>
      <td>blue</td>
      <td>2.534951e+06</td>
      <td>4522283</td>
      <td>1.783973e+00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>anarchy-beach</td>
      <td>Siedl</td>
      <td>POLYGON ((2556843.000 1143908.000, 2556795.000...</td>
      <td>slategray</td>
      <td>2.534951e+06</td>
      <td>2262184</td>
      <td>8.923979e-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>anarchy-beach</td>
      <td>Siedl</td>
      <td>POLYGON ((2555722.000 1145591.000, 2555380.000...</td>
      <td>slategray</td>
      <td>2.534951e+06</td>
      <td>248855</td>
      <td>9.816984e-02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>anarchy-beach</td>
      <td>Siedl</td>
      <td>POLYGON ((2556895.000 1143855.000, 2556843.000...</td>
      <td>slategray</td>
      <td>2.534951e+06</td>
      <td>23910</td>
      <td>9.432265e-03</td>
    </tr>
    <tr>
      <th>0</th>
      <td>anarchy-beach</td>
      <td>undefined</td>
      <td>MULTIPOLYGON (((2557000.338 1144004.311, 25570...</td>
      <td>khaki</td>
      <td>2.534951e+06</td>
      <td>0</td>
      <td>8.626095e-15</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>buffer-name</th>
      <th>land-cover</th>
      <th>geometry</th>
      <th>color</th>
      <th>buffer-area-dry</th>
      <th>area_m2</th>
      <th>rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>anarchy-beach</td>
      <td>See</td>
      <td>POLYGON ((2554545.000 1145275.000, 2554865.000...</td>
      <td>blue</td>
      <td>2.534951e+06</td>
      <td>4.522283e+06</td>
      <td>1.783973e+00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>anarchy-beach</td>
      <td>Siedl</td>
      <td>POLYGON ((2556843.000 1143908.000, 2556795.000...</td>
      <td>slategray</td>
      <td>2.534951e+06</td>
      <td>2.262184e+06</td>
      <td>8.923979e-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>anarchy-beach</td>
      <td>Siedl</td>
      <td>POLYGON ((2555722.000 1145591.000, 2555380.000...</td>
      <td>slategray</td>
      <td>2.534951e+06</td>
      <td>2.488550e+05</td>
      <td>9.816984e-02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>anarchy-beach</td>
      <td>Siedl</td>
      <td>POLYGON ((2556895.000 1143855.000, 2556843.000...</td>
      <td>slategray</td>
      <td>2.534951e+06</td>
      <td>2.391000e+04</td>
      <td>9.432265e-03</td>
    </tr>
    <tr>
      <th>0</th>
      <td>anarchy-beach</td>
      <td>undefined</td>
      <td>MULTIPOLYGON (((2557000.338 1144004.311, 25570...</td>
      <td>khaki</td>
      <td>2.534951e+06</td>
      <td>0.000000e+00</td>
      <td>8.626095e-15</td>
    </tr>
    <tr>
      <th>0</th>
      <td>anarchy-beach</td>
      <td>public-services</td>
      <td>MULTIPOLYGON Z (((2555485.507 1144291.188 372....</td>
      <td>red</td>
      <td>7.057234e+06</td>
      <td>2.511881e+05</td>
      <td>3.559299e-02</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_8b35d tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_8b35d tr:nth-child(odd) {
  background: #FFF;
}
#T_8b35d tr {
  font-size: 12px;
}
#T_8b35d th {
  background-color: #FFF;
  font-size: 12px;
  text-align: left;
  width: auto;
  word-break: keep-all;
}
#T_8b35d td {
  padding: 4px;
  font-size: 12px;
  text-align: center;
}
#T_8b35d caption {
  caption-side: top;
  font-size: 1em;
  text-align: left;
  margin-bottom: 10px;
}
</style>
<table id="T_8b35d">
  <thead>
    <tr>
      <th id="T_8b35d_level0_col0" class="col_heading level0 col0" >buffer-name</th>
      <th id="T_8b35d_level0_col1" class="col_heading level0 col1" >land-cover</th>
      <th id="T_8b35d_level0_col2" class="col_heading level0 col2" >area_m2</th>
      <th id="T_8b35d_level0_col3" class="col_heading level0 col3" >% of buffer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_8b35d_row0_col0" class="data row0 col0" >anarchy-beach</td>
      <td id="T_8b35d_row0_col1" class="data row0 col1" >See</td>
      <td id="T_8b35d_row0_col2" class="data row0 col2" >4'522'283</td>
      <td id="T_8b35d_row0_col3" class="data row0 col3" >1,78</td>
    </tr>
    <tr>
      <td id="T_8b35d_row1_col0" class="data row1 col0" >anarchy-beach</td>
      <td id="T_8b35d_row1_col1" class="data row1 col1" >Siedl</td>
      <td id="T_8b35d_row1_col2" class="data row1 col2" >2'262'184</td>
      <td id="T_8b35d_row1_col3" class="data row1 col3" >0,89</td>
    </tr>
    <tr>
      <td id="T_8b35d_row2_col0" class="data row2 col0" >anarchy-beach</td>
      <td id="T_8b35d_row2_col1" class="data row2 col1" >Siedl</td>
      <td id="T_8b35d_row2_col2" class="data row2 col2" >248'855</td>
      <td id="T_8b35d_row2_col3" class="data row2 col3" >0,10</td>
    </tr>
    <tr>
      <td id="T_8b35d_row3_col0" class="data row3 col0" >anarchy-beach</td>
      <td id="T_8b35d_row3_col1" class="data row3 col1" >Siedl</td>
      <td id="T_8b35d_row3_col2" class="data row3 col2" >23'910</td>
      <td id="T_8b35d_row3_col3" class="data row3 col3" >0,01</td>
    </tr>
    <tr>
      <td id="T_8b35d_row4_col0" class="data row4 col0" >anarchy-beach</td>
      <td id="T_8b35d_row4_col1" class="data row4 col1" >undefined</td>
      <td id="T_8b35d_row4_col2" class="data row4 col2" >0</td>
      <td id="T_8b35d_row4_col3" class="data row4 col3" >0,00</td>
    </tr>
    <tr>
      <td id="T_8b35d_row5_col0" class="data row5 col0" >anarchy-beach</td>
      <td id="T_8b35d_row5_col1" class="data row5 col1" >public-services</td>
      <td id="T_8b35d_row5_col2" class="data row5 col2" >251'188</td>
      <td id="T_8b35d_row5_col3" class="data row5 col3" >0,04</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">streets</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">length</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    5526.40911
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/e9d5ab06c253a65f0c8a6bc52ad9f867b7eec9d24fbc4ba5d6ee5de224d0513f.png" src="_images/e9d5ab06c253a65f0c8a6bc52ad9f867b7eec9d24fbc4ba5d6ee5de224d0513f.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/2a9deb60f3b91a4df7ffbbb5e6c20aeafcf462e0571dec3dced61eaea4dd992c.png" src="_images/2a9deb60f3b91a4df7ffbbb5e6c20aeafcf462e0571dec3dced61eaea4dd992c.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_250334/2395655611.py:8: UserWarning: The GeoDataFrame you are attempting to plot is empty. Nothing has been displayed.
  wald.plot(ax=ax, facecolor=&#39;yellowgreen&#39;, edgecolor=&#39;darkgreen&#39;, alpha=1, hatch=&#39;oo&#39;,zorder=1)
</pre></div>
</div>
<img alt="_images/795c5203fdd1548d51eb6dc21c668ca4188da0f1c84652a33dcd2b38db9a8985.png" src="_images/795c5203fdd1548d51eb6dc21c668ca4188da0f1c84652a33dcd2b38db9a8985.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/31ff44fba319361ac646f6e3120caea1195fc07597898ae541cf6ca3582999f1.png" src="_images/31ff44fba319361ac646f6e3120caea1195fc07597898ae541cf6ca3582999f1.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/6eeb49561a4fc243279d1e5b4e7bdc63bda42f9ee394fe152537b06a4226e586.png" src="_images/6eeb49561a4fc243279d1e5b4e7bdc63bda42f9ee394fe152537b06a4226e586.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/3cb8da5a74d88b631ef83c8df79a210f0593100492f40bb79007573796bb4a56.png" src="_images/3cb8da5a74d88b631ef83c8df79a210f0593100492f40bb79007573796bb4a56.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_250334/2500445883.py:12: UserWarning: The GeoDataFrame you are attempting to plot is empty. Nothing has been displayed.
  wald.plot(ax=ax, facecolor=&#39;yellowgreen&#39;, edgecolor=&#39;darkgreen&#39;, alpha=1, hatch=&#39;oo&#39;,zorder=1)
</pre></div>
</div>
<img alt="_images/75faebd3764affa0782c04a3c7fe579b72ce51a967c27d0004911855b40b6e68.png" src="_images/75faebd3764affa0782c04a3c7fe579b72ce51a967c27d0004911855b40b6e68.png" />
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="extracting-land-use-values">
<span id="calculating-land-use"></span><h1>Extracting land use values<a class="headerlink" href="#extracting-land-use-values" title="Link to this heading">#</a></h1>
<p>This is a summary of the methods used to extract topographical features from vector and points layers. The source for the vector layer is  <a class="reference external" href="https://www.swisstopo.admin.ch/de/landschaftsmodell-swisstlmregio">swissTLMRegio</a>.</p>
<p>QGIS is not the optimal tool for this operation if the intention is to automate the aquisition of the data. However for a limited number of users and relatively few sample locations added each year QGIS is adequate to the task. A summary of the methods for using QGIS is <a class="reference internal" href="#usingqgis"><span class="std std-ref">below</span></a>.</p>
<p><strong>Note: 1’500 meter buffer (circular)</strong></p>
<p>The land-use chapter in the federal report generated alot of interest <a class="reference external" href="https://hammerdirt-analyst.github.io/IQAASL-End-0f-Sampling-2021/land_use_correlation.html">Land use profile - german</a>. It inspired an academic article and collaboration with Wagenigen Research and University.</p>
<p><strong>Why don’t the percentages add up to 100 ?</strong></p>
<p>This is because some features listed on the map are superimposed on to others. For example a wooded area may contain a public park, this would mean that the park is considered a feature and has a definite surface area but this is in addition to the surface area of the forested area where the park is located. In general we can define the difference in this way:</p>
<p><strong>Land-cover:</strong> Are elements such as buildings, forest, orchard or undefined. There is at least one land-cover element for each survey location. If so then it takes 100% of the available dry land.</p>
<p><strong>Land-use:</strong> Are elements that may or may not be in the buffer. These are items like schools, hospitals, water-treatment plants. Individually they are only a small portion of the available dry land.</p>
<section id="technical-requirements">
<h2>Technical requirements<a class="headerlink" href="#technical-requirements" title="Link to this heading">#</a></h2>
<p>In addition to pandas, python and numpy, the following python packages are required:</p>
<ol class="arabic simple">
<li><p>Geopandas</p></li>
<li><p>Shapely</p></li>
</ol>
<section id="a-point-and-a-buffer">
<h3>A point and a buffer<a class="headerlink" href="#a-point-and-a-buffer" title="Link to this heading">#</a></h3>
<p>The first step is to create a buffer of the appropriate radius with the point (survey locatio) at the center. The point is constructed by using gps coordinates for the location as arguments to <code class="docutils literal notranslate"><span class="pre">shapely.geometry.Point</span></code>. This is then converted to Geopandas.GeodataFrame (gdf) using the coordinate reference system (crs) of the point data. From the gdf, use the buffer method and collect the bounds.</p>
<p><strong>Making a buffer from a point</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># method to make the buffer, the point and the bufferbounds</span>
<span class="k">def</span> <span class="nf">a_point_buffer</span><span class="p">(</span><span class="n">this_location</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">buffer_radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span> <span class="n">coordinate_crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;epsg:4326&#39;</span><span class="p">,</span> <span class="n">to_crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;epsg:2056&quot;</span><span class="p">):</span>
    <span class="c1"># create a point, a buffer and buffer bounds for one location</span>
    <span class="n">this_geometry</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">this_location</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">this_location</span><span class="o">.</span><span class="n">latitude</span><span class="p">)]</span>
    <span class="n">this_shape</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">this_location</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">this_geometry</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">coordinate_crs</span><span class="p">)</span>
    <span class="n">this_shape</span> <span class="o">=</span> <span class="n">this_shape</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">to_crs</span><span class="p">)</span>

    <span class="n">this_buffer</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">this_shape</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_radius</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">to_crs</span><span class="p">)</span>
    <span class="n">location_buffer</span> <span class="o">=</span> <span class="n">this_buffer</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">this_shape</span><span class="p">,</span> <span class="n">location_buffer</span><span class="p">,</span> <span class="n">location_buffer</span><span class="o">.</span><span class="n">total_bounds</span>

<span class="c1"># select a location</span>
<span class="n">a_location</span> <span class="o">=</span> <span class="n">river_locations</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="c1"># retrieve the grid coordinates</span>
<span class="n">this_location</span> <span class="o">=</span> <span class="n">locations_and_coordinates</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">a_location</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># make the point, the buffer and the bounds</span>
<span class="n">this_point</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="n">bufferbounds</span> <span class="o">=</span> <span class="n">a_point_buffer</span><span class="p">(</span><span class="n">this_location</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="retrieve-location-attributes-land-cover">
<h3>Retrieve location attributes: land-cover<a class="headerlink" href="#retrieve-location-attributes-land-cover" title="Link to this heading">#</a></h3>
<p>The bounds and the buffer from the previous operation are used to construct an overlay for the .SHP file that holds the souce data. The name of the location is used to identify the buffer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">location_geo_attributes</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">shape_file</span><span class="p">,</span> <span class="n">objcolumn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;OBJVAL&#39;</span><span class="p">,</span> <span class="n">objval</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;land-cover&#39;</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">bounds</span>
    <span class="n">landcover</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">shape_file</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">))</span>
    <span class="n">landcover</span> <span class="o">=</span> <span class="n">landcover</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">landcover</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">landcover</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">,</span> <span class="n">keep_geom_type</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">landcover</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">objcolumn</span><span class="p">:</span><span class="n">objval</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">landcover</span><span class="p">[</span><span class="s1">&#39;buffer-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">buffer_name</span>
    
    <span class="k">return</span> <span class="n">landcover</span><span class="p">[[</span><span class="s1">&#39;buffer-name&#39;</span><span class="p">,</span> <span class="n">objval</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>

<span class="c1"># indentify the contents of the buffer    </span>
<span class="n">buffer_content</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="s1">&#39;data/ignorethis/shapes/landcover.shp&#39;</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="undefined-areas">
<h3>Undefined areas<a class="headerlink" href="#undefined-areas" title="Link to this heading">#</a></h3>
<p>Not all areas of the buffer will have a defined land-cover. To identify those areas, all of the <code class="docutils literal notranslate"><span class="pre">buffer_content</span></code> is <em>joined</em>. For this we use the <code class="docutils literal notranslate"><span class="pre">shapely.unary_union</span></code> method and provide the <code class="docutils literal notranslate"><span class="pre">buffer_content</span></code> as an argument. This will produce a separate gdf that is the negative of the <code class="docutils literal notranslate"><span class="pre">buffer_content</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># identify the undefined areas</span>
<span class="n">combined_polygon</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
<span class="n">combined_Pn</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">combined_polygon</span><span class="p">]},</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="n">undefined</span> <span class="o">=</span> <span class="n">compute_undefined_sections_of_buffer</span><span class="p">(</span><span class="n">abuffer</span><span class="p">,</span><span class="n">combined_Pn</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>

<span class="c1"># combine the known land cover with the undefined</span>
<span class="n">buffer_content_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">buffer_content_i</span><span class="p">,</span> <span class="n">undefined</span><span class="p">])</span>

<span class="c1"># assign </span>
<span class="n">buffer_content</span> <span class="o">=</span> <span class="n">assign_colors_to_polygons</span><span class="p">(</span><span class="n">buffer_content_i</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">land_use_colors</span><span class="p">,</span> <span class="n">objval</span><span class="o">=</span><span class="s1">&#39;land-cover&#39;</span><span class="p">)</span>
<span class="n">buffer_content</span> <span class="o">=</span> <span class="n">compute_landuse_percent_of_buffer</span><span class="p">(</span><span class="n">buffer_content</span><span class="p">,</span> <span class="n">abuffer</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">buffer_content</span><span class="p">[</span><span class="s1">&#39;area_m2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">buffer_content</span><span class="p">[</span><span class="s1">&#39;area_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
<p>To complete the process (for land-cover) the undefined areas are merged with the buffer_content and the surface area for each polygon is calculated.</p>
</section>
<section id="public-services-land-use">
<h3>Public services: land-use<a class="headerlink" href="#public-services-land-use" title="Link to this heading">#</a></h3>
<p>As noted earlier, some topographical features are overlayed on to other features. Here we are talking about two specific vector layers in the swissTLMRegio collection:</p>
<ol class="arabic simple">
<li><p>Nutuzungsareal : infrastructure or other usage</p></li>
<li><p>Freizeitareal : recreation area</p></li>
</ol>
<p>We are interested in these layers because they give us information about the activities that may occur in proximity to the survey location. The same method is used to extract the polygons as was done with land use. However, we are using the <code class="docutils literal notranslate"><span class="pre">shapely.unary_union</span></code> method on the entire layer. Which means that we are not differentiating between the subcategories in each layer.</p>
<p>Once the buffer overlay has been applied to both layers the contents are combined and added to the buffer_content data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># infrastructure</span>
<span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">objcolumn</span><span class="o">=</span><span class="s1">&#39;OBJEKTART&#39;</span><span class="p">,</span> <span class="n">objval</span><span class="o">=</span><span class="s1">&#39;land-use&#39;</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
<span class="n">nz</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span> <span class="s1">&#39;data/ignorethis/shapes/nutuzungsareal.shp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="n">nz_comb</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">nz</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
<span class="n">nz_comb</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">nz_comb</span><span class="p">]},</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

<span class="c1"># recreational areas</span>
<span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">objcolumn</span><span class="o">=</span><span class="s1">&#39;OBJEKTART&#39;</span><span class="p">,</span> <span class="n">objval</span><span class="o">=</span><span class="s1">&#39;land-use&#39;</span><span class="p">,</span> <span class="n">buffer_name</span><span class="o">=</span><span class="n">a_location</span><span class="p">)</span>
<span class="n">fz</span> <span class="o">=</span> <span class="n">location_geo_attributes</span><span class="p">(</span><span class="n">bufferbounds</span><span class="p">,</span> <span class="n">abuffer</span><span class="p">,</span><span class="s1">&#39;data/ignorethis/shapes/freizeit.shp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="n">fz_comb</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">fz</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
<span class="n">fz_comb</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">fz_comb</span><span class="p">]},</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

<span class="c1"># combine them all into one category called public services</span>
<span class="n">public_service</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">nz</span><span class="p">,</span> <span class="n">fz</span><span class="p">])</span>
<span class="n">ps_comb</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">public_service</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ps_comb</span><span class="p">],</span>
    <span class="s1">&#39;land-cover&#39;</span><span class="p">:[</span><span class="s1">&#39;public-services&#39;</span><span class="p">],</span>
    <span class="s1">&#39;buffer-name&#39;</span><span class="p">:[</span><span class="n">a_location</span><span class="p">],</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span>
<span class="p">}</span>
<span class="n">ps_comb</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">buffer_content_i</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="n">ps_comb</span> <span class="o">=</span> <span class="n">compute_landuse_percent_of_buffer</span><span class="p">(</span><span class="n">ps_comb</span><span class="p">,</span> <span class="n">abuffer</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># combine the public services and the land-cover</span>
<span class="n">land_use_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">buffer_content</span><span class="p">,</span> <span class="n">ps_comb</span><span class="p">])</span>
<span class="n">land_use_profile</span><span class="p">[</span><span class="s1">&#39;area_m2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">land_use_profile</span><span class="p">[</span><span class="s1">&#39;area_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">land_use_profile</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">land_use_profile</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">land_use_profile</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f buffer&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Which results in the land-use profile for the location in question, (not including streets).</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text">Land use and cover for a location.</p>
</div>
<div class="sd-card-body docutils">
<div class="output text_html"><style type="text/css">
#T_8b35d tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_8b35d tr:nth-child(odd) {
  background: #FFF;
}
#T_8b35d tr {
  font-size: 12px;
}
#T_8b35d th {
  background-color: #FFF;
  font-size: 12px;
  text-align: left;
  width: auto;
  word-break: keep-all;
}
#T_8b35d td {
  padding: 4px;
  font-size: 12px;
  text-align: center;
}
#T_8b35d caption {
  caption-side: top;
  font-size: 1em;
  text-align: left;
  margin-bottom: 10px;
}
</style>
<table id="T_8b35d">
  <thead>
    <tr>
      <th id="T_8b35d_level0_col0" class="col_heading level0 col0" >buffer-name</th>
      <th id="T_8b35d_level0_col1" class="col_heading level0 col1" >land-cover</th>
      <th id="T_8b35d_level0_col2" class="col_heading level0 col2" >area_m2</th>
      <th id="T_8b35d_level0_col3" class="col_heading level0 col3" >% of buffer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_8b35d_row0_col0" class="data row0 col0" >anarchy-beach</td>
      <td id="T_8b35d_row0_col1" class="data row0 col1" >See</td>
      <td id="T_8b35d_row0_col2" class="data row0 col2" >4'522'283</td>
      <td id="T_8b35d_row0_col3" class="data row0 col3" >1,78</td>
    </tr>
    <tr>
      <td id="T_8b35d_row1_col0" class="data row1 col0" >anarchy-beach</td>
      <td id="T_8b35d_row1_col1" class="data row1 col1" >Siedl</td>
      <td id="T_8b35d_row1_col2" class="data row1 col2" >2'262'184</td>
      <td id="T_8b35d_row1_col3" class="data row1 col3" >0,89</td>
    </tr>
    <tr>
      <td id="T_8b35d_row2_col0" class="data row2 col0" >anarchy-beach</td>
      <td id="T_8b35d_row2_col1" class="data row2 col1" >Siedl</td>
      <td id="T_8b35d_row2_col2" class="data row2 col2" >248'855</td>
      <td id="T_8b35d_row2_col3" class="data row2 col3" >0,10</td>
    </tr>
    <tr>
      <td id="T_8b35d_row3_col0" class="data row3 col0" >anarchy-beach</td>
      <td id="T_8b35d_row3_col1" class="data row3 col1" >Siedl</td>
      <td id="T_8b35d_row3_col2" class="data row3 col2" >23'910</td>
      <td id="T_8b35d_row3_col3" class="data row3 col3" >0,01</td>
    </tr>
    <tr>
      <td id="T_8b35d_row4_col0" class="data row4 col0" >anarchy-beach</td>
      <td id="T_8b35d_row4_col1" class="data row4 col1" >undefined</td>
      <td id="T_8b35d_row4_col2" class="data row4 col2" >0</td>
      <td id="T_8b35d_row4_col3" class="data row4 col3" >0,00</td>
    </tr>
    <tr>
      <td id="T_8b35d_row5_col0" class="data row5 col0" >anarchy-beach</td>
      <td id="T_8b35d_row5_col1" class="data row5 col1" >public-services</td>
      <td id="T_8b35d_row5_col2" class="data row5 col2" >251'188</td>
      <td id="T_8b35d_row5_col3" class="data row5 col3" >0,04</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="building-a-map-of-land-cover">
<h3>Building a map of land cover<a class="headerlink" href="#building-a-map-of-land-cover" title="Link to this heading">#</a></h3>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-1 sd-row-cols-xs-1 sd-row-cols-sm-1 sd-row-cols-md-2 sd-row-cols-lg-2 sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<img alt="_images/e9d5ab06c253a65f0c8a6bc52ad9f867b7eec9d24fbc4ba5d6ee5de224d0513f.png" src="_images/e9d5ab06c253a65f0c8a6bc52ad9f867b7eec9d24fbc4ba5d6ee5de224d0513f.png" />
</div>
<div class="sd-card-footer docutils">
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<img alt="_images/2a9deb60f3b91a4df7ffbbb5e6c20aeafcf462e0571dec3dced61eaea4dd992c.png" src="_images/2a9deb60f3b91a4df7ffbbb5e6c20aeafcf462e0571dec3dced61eaea4dd992c.png" />
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">Surface area: 4’145’791 m², % of buffer: 59%</p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<img alt="_images/795c5203fdd1548d51eb6dc21c668ca4188da0f1c84652a33dcd2b38db9a8985.png" src="_images/795c5203fdd1548d51eb6dc21c668ca4188da0f1c84652a33dcd2b38db9a8985.png" />
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">Surface area: 1’528’977 m², % of buffer: 22%</p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<img alt="_images/31ff44fba319361ac646f6e3120caea1195fc07597898ae541cf6ca3582999f1.png" src="_images/31ff44fba319361ac646f6e3120caea1195fc07597898ae541cf6ca3582999f1.png" />
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">Surface area: 1’484’991 m², % of buffer: 21%</p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<img alt="_images/6eeb49561a4fc243279d1e5b4e7bdc63bda42f9ee394fe152537b06a4226e586.png" src="_images/6eeb49561a4fc243279d1e5b4e7bdc63bda42f9ee394fe152537b06a4226e586.png" />
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">Surface area: 1’382’463 m², % of buffer: 20%</p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<img alt="_images/3cb8da5a74d88b631ef83c8df79a210f0593100492f40bb79007573796bb4a56.png" src="_images/3cb8da5a74d88b631ef83c8df79a210f0593100492f40bb79007573796bb4a56.png" />
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">Total length of streets : 17km</p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<img alt="_images/75faebd3764affa0782c04a3c7fe579b72ce51a967c27d0004911855b40b6e68.png" src="_images/75faebd3764affa0782c04a3c7fe579b72ce51a967c27d0004911855b40b6e68.png" />
</div>
<div class="sd-card-footer docutils">
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="using-qgis">
<span id="usingqgis"></span><h2>Using QGIS<a class="headerlink" href="#using-qgis" title="Link to this heading">#</a></h2>
<p>For this method we are using the land-cover layer from swissTLM regio</p>
<p>finished columns = slug, attribute , attribute_type, area, dry,	scale</p>
<p>In QGIS:</p>
<ol class="arabic simple">
<li><p>create a buffer around each survey point</p>
<ul class="simple">
<li><p>make sure that the survey location and feature_type is in the attributes of the new buffer layer</p></li>
<li><p>the survey locations are loaded as points from .csv file</p></li>
<li><p>reproject the points layer to the project CRS</p></li>
</ul>
</li>
<li><p>use the new buffer layer as an overlay to the land-cover layer</p>
<ul class="simple">
<li><p>use the overlay intersection tool</p></li>
<li><p>select the fields to keep from the buffer (slug and feature type)</p></li>
<li><p>select the fields to keep from the land-cover layer</p></li>
<li><p>run the function</p></li>
<li><p>this creates a temporary layer called <em>intersection</em></p></li>
</ul>
</li>
<li><p>get the surface area of all the land-cover and land-use features in each buffer of the temporary layer</p>
<ul class="simple">
<li><p>use the field calculator for the attribute table of the layer</p></li>
<li><p>in the field calculator, make a new field and enter the formula <code class="docutils literal notranslate"><span class="pre">\$area</span></code></p></li>
<li><p>for this example the method is elipsoid <em>bessel 1841 (epsg 7001)</em></p></li>
<li><p>this is set in the properties of the QGIS project</p></li>
<li><p>Export the layer as .csv</p></li>
</ul>
</li>
<li><p>verify the land-use features per location</p>
<ul class="simple">
<li><p>drop duplicate values: use location, feature and area to define duplicates</p></li>
<li><p>attention! different names for lake and reservoir</p>
<ul>
<li><p>change Stausee to See</p></li>
</ul>
</li>
</ul>
</li>
<li><p>make a dry land feature</p>
<ul class="simple">
<li><p>this is the surface area of the buffer that is not covered by water</p></li>
<li><p>substract the area of See from the area of the buffer</p></li>
<li><p>identify survey locations that have siginifcant water features but are not listed as lakes</p></li>
</ul>
</li>
<li><p>Scale the land-use attributes of interest to the available dry-land</p></li>
</ol>
<p><strong>Example making dry land columns and scaling the land-use</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># separate locations that are lakes</span>
<span class="c1"># recall that feature type has a designator for lakes</span>
<span class="n">lakes</span> <span class="o">=</span> <span class="n">lg</span><span class="p">[(</span><span class="n">lg</span><span class="o">.</span><span class="n">feature_ty</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="n">lg</span><span class="o">.</span><span class="n">slug</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">snl</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># from this subset of data separate the surface area covered by water</span>
<span class="c1"># set the slug to the index and substract the surface area of the water</span>
<span class="c1"># from the surface area of the buffer</span>
<span class="n">lake_only</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">[</span><span class="n">lakes</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="s2">&quot;See&quot;</span><span class="p">]</span>
<span class="n">lo</span> <span class="o">=</span> <span class="n">lake_only</span><span class="p">[[</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;slug&quot;</span><span class="p">)</span>

<span class="c1"># substract the lake value from the area of the buffer</span>
<span class="n">lo</span><span class="p">[</span><span class="s2">&quot;dry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7065000</span> <span class="o">-</span> <span class="n">lo</span><span class="o">.</span><span class="n">area</span>
<span class="n">lodry</span> <span class="o">=</span> <span class="n">lo</span><span class="p">[</span><span class="s2">&quot;dry&quot;</span><span class="p">]</span>

<span class="c1"># merge the original land-use data from lakes with the</span>
<span class="c1"># the dry land results</span>
<span class="n">lgi</span> <span class="o">=</span> <span class="n">lakes</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lo</span><span class="p">[</span><span class="s2">&quot;dry&quot;</span><span class="p">],</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># remove the lake feature from the features columns</span>
<span class="n">lgi</span> <span class="o">=</span> <span class="n">lgi</span><span class="p">[</span><span class="n">lgi</span><span class="o">.</span><span class="n">feature</span> <span class="o">!=</span> <span class="s2">&quot;See&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># scale the landuse feature to the available dry land</span>
<span class="n">lgi</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lgi</span><span class="o">.</span><span class="n">area</span><span class="o">/</span><span class="n">lgi</span><span class="o">.</span><span class="n">dry</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># repeat the process for locations that do not have a lake feature</span>
<span class="c1"># these locations are accounted for above</span>
<span class="n">eliminate</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">snl</span><span class="p">,</span> <span class="o">*</span><span class="n">lo</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="c1"># recuperate all other locations</span>
<span class="n">rivers_parcs</span> <span class="o">=</span> <span class="n">lg</span><span class="p">[</span><span class="o">~</span><span class="n">lg</span><span class="o">.</span><span class="n">slug</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">eliminate</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># define the dry land as the area of the buffer</span>
<span class="n">rivers_parcs</span><span class="p">[</span><span class="s2">&quot;dry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7065000</span>
<span class="c1"># scale the features with the dry land value</span>
<span class="n">rivers_parcs</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rivers_parcs</span><span class="o">.</span><span class="n">area</span><span class="o">/</span><span class="n">rivers_parcs</span><span class="o">.</span><span class="n">dry</span>

<span class="c1"># combine the two results</span>
<span class="n">land_cover</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">rivers_parcs</span><span class="p">,</span> <span class="n">lgi</span><span class="p">])</span>
</pre></div>
</div>
<p>Once the dry land value is calculated for each buffer of the land-cover buffer use the dry-land value to scale the components of the land-use buffer</p>
<section id="extracting-street-lengths">
<h3>Extracting street lengths<a class="headerlink" href="#extracting-street-lengths" title="Link to this heading">#</a></h3>
<p>The tlmREgio streets or strasse layer is applicable.</p>
<p><strong>Note:</strong> the street lenghts are not scaled</p>
<p>finished columns = slug, attribute, attribute_type, length</p>
<p><strong>Attention:</strong></p>
<ol class="arabic simple">
<li><p>The streets layer can have many copies of the same street in a buffer</p></li>
<li><p>The cumulative sum of a street in a layer can exceed the radius of the buffer (windy roads)</p></li>
<li><p>Dissolving the polylines of each buffer in the layer is essential</p></li>
<li><p>Drop duplicate values on slug, attribute, length</p></li>
<li><p>Using the same 1’500 m buffer that was used for land-cover and land-use. Intersect the buffer with the street layer</p></li>
<li><p>Dissolve the polylines in each buffer</p>
<ul class="simple">
<li><p>select the fields from the streets layer to keep (OBJVAL)</p></li>
<li><p>select the fields from the buffer layer to kepp (slug, feature_ty)</p></li>
<li><p>check the box <code class="docutils literal notranslate"><span class="pre">keep</span> <span class="pre">disjoint</span> <span class="pre">features</span> <span class="pre">separate</span></code></p></li>
<li><p>run the function</p></li>
<li><p>export to .csv</p></li>
</ul>
</li>
</ol>
<div class="cell tag_remove-input docutils container">
</div>
<section id="land-cover">
<h4>Land-cover<a class="headerlink" href="#land-cover" title="Link to this heading">#</a></h4>
<p>Land-cover attributes</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;undefined&#39;, &#39;Siedl&#39;, &#39;Wald&#39;, &#39;Reben&#39;, &#39;Obstanlage&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>land-cover attribute translations</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">land_cover_fr</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;undefined&#39;</span><span class="p">:</span> <span class="s1">&#39;Non défini&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Siedl&#39;</span><span class="p">:</span> <span class="s1">&#39;Siedl&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Wald&#39;</span><span class="p">:</span> <span class="s1">&#39;Forêt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Reben&#39;</span><span class="p">:</span> <span class="s1">&#39;Vignes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Obstanlage&#39;</span><span class="p">:</span> <span class="s1">&#39;Verger&#39;</span>
<span class="p">}</span>

<span class="n">land_cover_en</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;undefined&#39;</span><span class="p">:</span> <span class="s1">&#39;Undefined&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Siedl&#39;</span><span class="p">:</span> <span class="s1">&#39;Settlement&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Wald&#39;</span><span class="p">:</span> <span class="s1">&#39;Forest&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Reben&#39;</span><span class="p">:</span> <span class="s1">&#39;Vines&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Obstanlage&#39;</span><span class="p">:</span> <span class="s1">&#39;Orchard&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Land-cover results for one location</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>slug</th>
      <th>attribute</th>
      <th>attribute_type</th>
      <th>area</th>
      <th>dry</th>
      <th>scale</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>141</th>
      <td>parc-des-pierrettes</td>
      <td>undefined</td>
      <td>land-cover</td>
      <td>68285</td>
      <td>3832559</td>
      <td>0.018</td>
    </tr>
    <tr>
      <th>623</th>
      <td>parc-des-pierrettes</td>
      <td>Siedl</td>
      <td>land-cover</td>
      <td>3606885</td>
      <td>3832559</td>
      <td>0.941</td>
    </tr>
    <tr>
      <th>624</th>
      <td>parc-des-pierrettes</td>
      <td>Wald</td>
      <td>land-cover</td>
      <td>157389</td>
      <td>3832559</td>
      <td>0.041</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="land-use">
<h4>Land-use<a class="headerlink" href="#land-use" title="Link to this heading">#</a></h4>
<p>Land-use attributes:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Baumschule&#39;, &#39;Friedhof&#39;, &#39;Schul- und Hochschulareal&#39;,
       &#39;Wald nicht bestockt&#39;, &#39;Abwasserreinigungsareal&#39;,
       &#39;Historisches Areal&#39;, &#39;Kraftwerkareal&#39;, &#39;Schrebergartenareal&#39;,
       &#39;Truppenuebungsplatz&#39;, &#39;Unterwerkareal&#39;,
       &#39;Kehrichtverbrennungsareal&#39;, &#39;Spitalareal&#39;,
       &#39;Oeffentliches Parkareal&#39;, &#39;Messeareal&#39;,
       &#39;Massnahmenvollzugsanstaltsareal&#39;, &#39;Kiesabbauareal&#39;,
       &#39;Steinbruchareal&#39;, &#39;Klosterareal&#39;, &#39;Deponieareal&#39;, &#39;Antennenareal&#39;,
       &#39;Lehmabbauareal&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Land-use translations and groups</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">land_use_fr</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Baumschule&#39;</span><span class="p">:</span> <span class="s1">&#39;Pépinière&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Friedhof&#39;</span><span class="p">:</span> <span class="s1">&#39;Cimetière&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Schul- und Hochschulareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone scolaire et universitaire&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Wald nicht bestockt&#39;</span><span class="p">:</span> <span class="s1">&#39;Forêt non peuplée&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Abwasserreinigungsareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone de traitement des eaux usées&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Historisches Areal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone historique&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Kraftwerkareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone de centrale électrique&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Schrebergartenareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone de jardins familiaux&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Truppenübungsplatz&#39;</span><span class="p">:</span> <span class="s1">&#39;Terrain d</span><span class="se">\&#39;</span><span class="s1">entraînement militaire&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Unterwerkareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone de sous-station&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Kehrichtverbrennungsareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone d</span><span class="se">\&#39;</span><span class="s1">incinération des déchets&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Spitalareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone d</span><span class="se">\&#39;</span><span class="s1">hôpital&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Öffentliches Parkareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone de parc public&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Messeareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone d</span><span class="se">\&#39;</span><span class="s1">exposition&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Massnahmenvollzugsanstaltsareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone d</span><span class="se">\&#39;</span><span class="s1">établissement de traitement&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Kiesabbauareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone d</span><span class="se">\&#39;</span><span class="s1">extraction de gravier&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Steinbruchareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone de carrière&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Klosterareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone de monastère&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Deponieareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone de décharge&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Antennenareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone d</span><span class="se">\&#39;</span><span class="s1">antennes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Lehmabbauareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone d</span><span class="se">\&#39;</span><span class="s1">extraction d</span><span class="se">\&#39;</span><span class="s1">argile&#39;</span>
<span class="p">}</span>

<span class="n">land_use_en</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Baumschule&#39;</span><span class="p">:</span> <span class="s1">&#39;Nursery&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Friedhof&#39;</span><span class="p">:</span> <span class="s1">&#39;Cemetery&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Schul- und Hochschulareal&#39;</span><span class="p">:</span> <span class="s1">&#39;School and University Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Wald nicht bestockt&#39;</span><span class="p">:</span> <span class="s1">&#39;Non-stocked Forest&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Abwasserreinigungsareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Wastewater Treatment Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Historisches Areal&#39;</span><span class="p">:</span> <span class="s1">&#39;Historical Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Kraftwerkareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Power Plant Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Schrebergartenareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Allotment Garden Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Truppenübungsplatz&#39;</span><span class="p">:</span> <span class="s1">&#39;Military Training Ground&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Unterwerkareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Substation Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Kehrichtverbrennungsareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Waste Incineration Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Spitalareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Hospital Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Öffentliches Parkareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Public Park Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Messeareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Exhibition Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Massnahmenvollzugsanstaltsareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Correctional Facility Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Kiesabbauareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Gravel Extraction Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Steinbruchareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Quarry Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Klosterareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Monastery Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Deponieareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Landfill Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Antennenareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Antenna Area&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Lehmabbauareal&#39;</span><span class="p">:</span> <span class="s1">&#39;Clay Extraction Area&#39;</span>
<span class="p">}</span>

<span class="c1"># land_uses_grouped:</span>
<span class="c1"># outdoor non technical use:</span>
<span class="n">lu_non_tech</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Friedhof&#39;</span><span class="p">,</span> <span class="s1">&#39;Hitorisches Areal&#39;</span><span class="p">,</span> <span class="s1">&#39;Schrebergartenareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Öffentliches Parkareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Messeareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Klosterareal&#39;</span><span class="p">,</span>  <span class="s1">&#39;Wald nicht bestockt&#39;</span><span class="p">]</span>

<span class="c1"># technical-extraction-incineration</span>
<span class="n">lu_extraction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Kiesabbauareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Steinbruchareal&#39;</span><span class="p">,</span>  <span class="s1">&#39;Lehmabbauareal&#39;</span><span class="p">,]</span>

<span class="c1"># waste-water-treatment-powere</span>
<span class="n">lu_technical</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Kehrichtverbrennungsareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Deponieareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Deponieareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Abwasserreinigungsareal&#39;</span><span class="p">,</span><span class="s1">&#39;Unterwerkareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Antennenareal&#39;</span><span class="p">]</span>

<span class="c1"># services:</span>
<span class="n">lu_serives</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Massnahmenvollzugsanstaltsareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Schul- und Hochschulareal&#39;</span><span class="p">,</span> <span class="s1">&#39;Spitalareal&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Land-use for one location:</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>slug</th>
      <th>attribute</th>
      <th>attribute_type</th>
      <th>area</th>
      <th>dry</th>
      <th>scale</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>685</th>
      <td>parc-des-pierrettes</td>
      <td>Abwasserreinigungsareal</td>
      <td>land-use</td>
      <td>49488</td>
      <td>3832559</td>
      <td>0.012913</td>
    </tr>
    <tr>
      <th>686</th>
      <td>parc-des-pierrettes</td>
      <td>Friedhof</td>
      <td>land-use</td>
      <td>11325</td>
      <td>3832559</td>
      <td>0.002955</td>
    </tr>
    <tr>
      <th>687</th>
      <td>parc-des-pierrettes</td>
      <td>Oeffentliches Parkareal</td>
      <td>land-use</td>
      <td>175591</td>
      <td>3832559</td>
      <td>0.045816</td>
    </tr>
    <tr>
      <th>688</th>
      <td>parc-des-pierrettes</td>
      <td>Schrebergartenareal</td>
      <td>land-use</td>
      <td>17306</td>
      <td>3832559</td>
      <td>0.004516</td>
    </tr>
    <tr>
      <th>689</th>
      <td>parc-des-pierrettes</td>
      <td>Schul- und Hochschulareal</td>
      <td>land-use</td>
      <td>1189161</td>
      <td>3832559</td>
      <td>0.310279</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="streets">
<h4>Streets<a class="headerlink" href="#streets" title="Link to this heading">#</a></h4>
<p>Streets attributes:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Autostr&#39;, &#39;Fahrstraes&#39;, &#39;Fussweg&#39;, &#39;HauptStrAB6&#39;, &#39;VerbindStr4&#39;,
       &#39;NebenStr3&#39;, &#39;VerbindStr6&#39;, &#39;Autobahn&#39;, &#39;HauptStrAB4&#39;, &#39;NebenStr6&#39;,
       &#39;Autob_Ri&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Streets: translations and groups</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">streets_fr</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Autostr&#39;</span><span class="p">:</span> <span class="s1">&#39;autoroute&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NebenStr3&#39;</span><span class="p">:</span> <span class="s1">&#39;route secondaire 3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NebenStr6&#39;</span><span class="p">:</span> <span class="s1">&#39;route secondaire 6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HauptStrAB6&#39;</span><span class="p">:</span> <span class="s1">&#39;route principale 6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HauptStrAB4&#39;</span><span class="p">:</span> <span class="s1">&#39;route principale 4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Fahrstraes&#39;</span><span class="p">:</span> <span class="s1">&#39;chemin carrossable&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Fussweg&#39;</span><span class="p">:</span> <span class="s1">&#39;chemin pédestre&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Autobahn&#39;</span><span class="p">:</span> <span class="s1">&#39;autoroute&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Autob_Ri&#39;</span><span class="p">:</span> <span class="s1">&#39;autoroute&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VerbindStr4&#39;</span><span class="p">:</span> <span class="s1">&#39;route de liason 4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VerbindStr6&#39;</span><span class="p">:</span> <span class="s1">&#39;route de liason 6&#39;</span><span class="p">,</span>   
<span class="p">}</span>

<span class="n">streets_en</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Autostr&#39;</span><span class="p">:</span> <span class="s1">&#39;freeway&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NebenStr3&#39;</span><span class="p">:</span> <span class="s1">&#39;surface streets 3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NebenStr6&#39;</span><span class="p">:</span> <span class="s1">&#39;surface streets 3 6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HauptStrAB6&#39;</span><span class="p">:</span> <span class="s1">&#39;inter regional 6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HauptStrAB4&#39;</span><span class="p">:</span> <span class="s1">&#39;inter regional 4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Fahrstraes&#39;</span><span class="p">:</span> <span class="s1">&#39;bridle path&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Fussweg&#39;</span><span class="p">:</span> <span class="s1">&#39;pedestrian trail&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Autobahn&#39;</span><span class="p">:</span> <span class="s1">&#39;freeway&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Autob_Ri&#39;</span><span class="p">:</span> <span class="s1">&#39;freeway&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VerbindStr4&#39;</span><span class="p">:</span> <span class="s1">&#39;intra regional 4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VerbindStr6&#39;</span><span class="p">:</span> <span class="s1">&#39;intra regional 6&#39;</span><span class="p">,</span>   
<span class="p">}</span>

</pre></div>
</div>
<p>The streets at one survey location:</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>slug</th>
      <th>attribute_type</th>
      <th>attribute</th>
      <th>length</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>638</th>
      <td>parc-des-pierrettes</td>
      <td>streets</td>
      <td>Autobahn</td>
      <td>1685</td>
    </tr>
    <tr>
      <th>639</th>
      <td>parc-des-pierrettes</td>
      <td>streets</td>
      <td>Fahrstraes</td>
      <td>1046</td>
    </tr>
    <tr>
      <th>640</th>
      <td>parc-des-pierrettes</td>
      <td>streets</td>
      <td>Fussweg</td>
      <td>3257</td>
    </tr>
    <tr>
      <th>641</th>
      <td>parc-des-pierrettes</td>
      <td>streets</td>
      <td>HauptStrAB6</td>
      <td>2918</td>
    </tr>
    <tr>
      <th>642</th>
      <td>parc-des-pierrettes</td>
      <td>streets</td>
      <td>NebenStr3</td>
      <td>2850</td>
    </tr>
    <tr>
      <th>643</th>
      <td>parc-des-pierrettes</td>
      <td>streets</td>
      <td>VerbindStr4</td>
      <td>67</td>
    </tr>
    <tr>
      <th>644</th>
      <td>parc-des-pierrettes</td>
      <td>streets</td>
      <td>VerbindStr6</td>
      <td>2864</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
</section>
<section id="rivers-intersection-size-and-class">
<h2>Rivers: intersection, size and class<a class="headerlink" href="#rivers-intersection-size-and-class" title="Link to this heading">#</a></h2>
<p>This requires the 1’500 m buffer created at the begininng and the rivers layer and the lakes layer.</p>
<section id="intersection-size-and-class">
<h3>intersection, size and class<a class="headerlink" href="#intersection-size-and-class" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Create a points layer of the intersection of rivers to lakes</p>
<ul class="simple">
<li><p>Keep only points that are labeled as river (fluss, fluss_u)</p></li>
<li><p>Use the attribute table to select the points</p></li>
</ul>
</li>
<li><p>Overlay the 1 500 m buffer on the new layer and collect all the intersections within each buffer</p>
<ul class="simple">
<li><p>export to .csv</p></li>
</ul>
</li>
<li><p>Check for intersections that do not have lake name</p>
<ul class="simple">
<li><p>not all lakes and rivers have names in the layer</p></li>
<li><p>find the correct name for the lake and add it to the record</p></li>
<li><p>replace river names with nan value with “no name”</p></li>
</ul>
</li>
</ol>
</section>
<section id="distance-to-intersection">
<h3>distance to intersection<a class="headerlink" href="#distance-to-intersection" title="Link to this heading">#</a></h3>
<p><strong>Note:</strong> the intersection points layer needs to be available</p>
<ol class="arabic simple">
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">hub</span> <span class="pre">lines</span></code> tool in QGIS draw lines from survey location to intersect location</p>
<ul class="simple">
<li><p>Limit the distance to the radius of the buffer</p></li>
<li><p>join on the slug field in both layers</p></li>
<li><p>eliminate duplicates</p></li>
<li><p>calculate the length of the line with <code class="docutils literal notranslate"><span class="pre">$length</span></code> in field calculator of the attribute table</p></li>
<li><p>export to .csv</p></li>
</ul>
</li>
<li><p>Identify locations (slugs) that are missing either the river_name or lake</p>
<ul class="simple">
<li><p>use the previous results (intersection, size and class) to fill in the missing values</p></li>
<li><p>check that slugs not in the distance matrix are truly without intersections</p></li>
</ul>
</li>
</ol>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>slug</th>
      <th>lake</th>
      <th>river_name</th>
      <th>size</th>
      <th>class</th>
      <th>distance</th>
      <th>attribute_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>72</th>
      <td>parc-des-pierrettes</td>
      <td>Le Léman</td>
      <td>La Mèbre</td>
      <td>8</td>
      <td>8</td>
      <td>333</td>
      <td>river intersection</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Author: hammerdirt-analyst

conda environment: cantonal_report

matplotlib: 3.8.4
geopandas : 0.14.4
pandas    : 2.2.2
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="the_survey_data.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">The survey data</p>
      </div>
    </a>
    <a class="right-next"
       href="multinomial_conjugate.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Empirical Bayes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#technical-requirements">Technical requirements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-point-and-a-buffer">A point and a buffer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-location-attributes-land-cover">Retrieve location attributes: land-cover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#undefined-areas">Undefined areas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#public-services-land-use">Public services: land-use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-map-of-land-cover">Building a map of land cover</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-qgis">Using QGIS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-street-lengths">Extracting street lengths</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#land-cover">Land-cover</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#land-use">Land-use</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#streets">Streets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rivers-intersection-size-and-class">Rivers: intersection, size and class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#intersection-size-and-class">intersection, size and class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-to-intersection">distance to intersection</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the-team@
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>